<div th:fragment="survey-modal">
    <link rel="stylesheet" th:href="@{/styles/blocks/survey-modal-styles.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<div class="modal fade" id="surveyModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog survey-modal">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="fas fa-clipboard-list me-2"></i>–ê–Ω–∫–µ—Ç–∞ –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="preferenceForm" th:action="@{/survey/submit}" method="POST">
                <div class="modal-body">
                    <div class="progress mb-4">
                        <div id="surveyProgress" class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
                    </div>

                    <!-- –í–æ–ø—Ä–æ—Å 1: –¶–µ–ª—å –ø–æ–µ–∑–¥–∫–∏ -->
                    <div class="survey-question" id="q1">
                        <h4><span class="badge bg-primary me-2">1/6</span> –ö–∞–∫—É—é –º–∞–≥–∏—é –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –≤—ã –∏—â–µ—Ç–µ? ‚ú®</h4>
                        <div class="options mt-3">
                            <label class="option-card d-block">
                                <input type="radio" name="purpose" value="–ü–ª—è–∂–Ω—ã–π –æ—Ç–¥—ã—Ö,–†–µ–ª–∞–∫—Å,–ú–æ—Ä–µ">
                                <span class="emoji-option">üèñÔ∏è</span> –ü–ª—è–∂–Ω—ã–π —Ä–µ–ª–∞–∫—Å - —Ç–æ–ª—å–∫–æ –º–æ—Ä–µ, —Å–æ–ª–Ω—Ü–µ –∏ —à–µ–∑–ª–æ–Ω–≥
                            </label>
                            <label class="option-card d-block">
                                <input type="radio" name="purpose" value="–ì–æ—Ä–Ω–æ–ª—ã–∂–Ω—ã–π –∫—É—Ä–æ—Ä—Ç,–¢—Ä–µ–∫–∏–Ω–≥">
                                <span class="emoji-option">‚õ∑Ô∏è</span> –ê–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö - –≥–æ—Ä—ã, –ª—ã–∂–∏ –∏ –∞–¥—Ä–µ–Ω–∞–ª–∏–Ω
                            </label>
                            <label class="option-card d-block">
                                <input type="radio" name="purpose" value="–ì–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—è,–í–∏–Ω–æ,–≠–∫—Å–∫—É—Ä—Å–∏—è">
                                <span class="emoji-option">üç∑</span> –ì–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ - –≤–∫—É—Å—ã –∏ –≤–∏–Ω–∞ –º–∏—Ä–∞
                            </label>
                            <label class="option-card d-block">
                                <input type="radio" name="purpose" value="–°–µ–º–µ–π–Ω—ã–π,–í—Å–µ –≤–∫–ª—é—á–µ–Ω–æ">
                                <span class="emoji-option">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span> –°–µ–º–µ–π–Ω—ã–π –æ—Ç–¥—ã—Ö - –∫–æ–º—Ñ–æ—Ä—Ç –∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö
                            </label>
                        </div>
                    </div>

                    <!-- –í–æ–ø—Ä–æ—Å 2: –ë—é–¥–∂–µ—Ç -->
                    <div class="survey-question" id="q2" style="display:none;">
                        <h4><span class="badge bg-primary me-2">2/6</span> –í–∞—à –±—é–¥–∂–µ—Ç –ø–æ—Ö–æ–∂ –Ω–∞... üí∞</h4>
                        <div class="options mt-3">
                            <label class="option-card d-block">
                                <input type="radio" name="budget" value="–ù–µ –Ω—É–∂–Ω–∞ –≤–∏–∑–∞">
                                <span class="emoji-option">üß≥</span> –†—é–∫–∑–∞–∫ - —ç–∫–æ–Ω–æ–º–ª—é –Ω–∞ –≤—Å–µ–º, –∫—Ä–æ–º–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–π
                            </label>
                            <label class="option-card d-block">
                                <input type="radio" name="budget" value="">
                                <span class="emoji-option">üíº</span> –ß–µ–º–æ–¥–∞–Ω - –∑–æ–ª–æ—Ç–∞—è —Å–µ—Ä–µ–¥–∏–Ω–∞ –∫–æ–º—Ñ–æ—Ä—Ç–∞ –∏ —Ü–µ–Ω—ã
                            </label>
                            <label class="option-card d-block">
                                <input type="radio" name="budget" value="–õ—é–∫—Å">
                                <span class="emoji-option">üõ≥Ô∏è</span> –Ø—Ö—Ç–∞ - —Ç–æ–ª—å–∫–æ –ª—É—á—à–∏–µ –æ—Ç–µ–ª–∏ –∏ —Å–µ—Ä–≤–∏—Å
                            </label>
                            <label class="option-card d-block">
                                <input type="radio" name="budget" value="–ù—É–∂–Ω–∞ –≤–∏–∑–∞">
                                <span class="emoji-option">‚úàÔ∏è</span> –ß–∞—Å—Ç–Ω—ã–π —Å–∞–º–æ–ª–µ—Ç - —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                            </label>
                        </div>
                    </div>

                    <!-- –í–æ–ø—Ä–æ—Å 3: –í—Ä–µ–º—è –≥–æ–¥–∞ -->
                    <div class="survey-question" id="q3" style="display:none;">
                        <h4><span class="badge bg-primary me-2">3/6</span> –ö–∞–∫–æ–µ –≤—Ä–µ–º—è –≥–æ–¥–∞ –≤ –≤–∞—à–µ–º —Å–µ—Ä–¥—Ü–µ —Å–µ–π—á–∞—Å? üå∏</h4>
                        <div class="options mt-3">
                            <label class="option-card d-block">
                                <input type="radio" name="season" value="–ü–ª—è–∂–Ω—ã–π –æ—Ç–¥—ã—Ö,–ú–æ—Ä–µ">
                                <span class="emoji-option">üåû</span> –õ–µ—Ç–æ - —Ç–æ–ª—å–∫–æ –ø–ª—è–∂–∏ –∏ –º–æ—Ä–µ!
                            </label>
                            <label class="option-card d-block">
                                <input type="radio" name="season" value="–ì–æ—Ä–Ω–æ–ª—ã–∂–Ω—ã–π –∫—É—Ä–æ—Ä—Ç">
                                <span class="emoji-option">‚ùÑÔ∏è</span> –ó–∏–º–∞ - —Å–Ω–µ–≥, –∫–∞–º–∏–Ω—ã –∏ –≥–æ—Ä–Ω–æ–ª—ã–∂–Ω—ã–µ –∫—É—Ä–æ—Ä—Ç—ã
                            </label>
                            <label class="option-card d-block">
                                <input type="radio" name="season" value="–≠–∫—Å–∫—É—Ä—Å–∏—è">
                                <span class="emoji-option">üçÇ</span> –û—Å–µ–Ω—å/–í–µ—Å–Ω–∞ - —ç–∫—Å–∫—É—Ä—Å–∏–∏ –±–µ–∑ —Ç–æ–ª–ø —Ç—É—Ä–∏—Å—Ç–æ–≤
                            </label>
                            <label class="option-card d-block">
                                <input type="radio" name="season" value="–ù–µ –Ω—É–∂–Ω–∞ –≤–∏–∑–∞">
                                <span class="emoji-option">üåé</span> –ú–Ω–µ –≤—Å–µ —Ä–∞–≤–Ω–æ - –≥–æ—Ç–æ–≤(–∞) –∫ –ª—é–±–æ–º—É —Å–µ–∑–æ–Ω—É
                            </label>
                        </div>
                    </div>

                    <!-- –í–æ–ø—Ä–æ—Å 4: –¢–µ–º–ø –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è -->
                    <div class="survey-question" id="q4" style="display:none;">
                        <h4><span class="badge bg-primary me-2">4/6</span> –í–∞—à –∏–¥–µ–∞–ª—å–Ω—ã–π —Ç–µ–º–ø –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è: ‚è±Ô∏è</h4>
                        <div class="options mt-3">
                            <label class="option-card d-block">
                                <input type="radio" name="pace" value="–†–µ–ª–∞–∫—Å,–í—Å–µ –≤–∫–ª—é—á–µ–Ω–æ">
                                <span class="emoji-option">üê¢</span> –ß–µ—Ä–µ–ø–∞—Ö–∞ - –º–∞–∫—Å–∏–º—É–º —Ä–µ–ª–∞–∫—Å–∞ —É –±–∞—Å—Å–µ–π–Ω–∞
                            </label>
                            <label class="option-card d-block">
                                <input type="radio" name="pace" value="–≠–∫—Å–∫—É—Ä—Å–∏—è">
                                <span class="emoji-option">üö∂</span> –ü–µ—à–µ—Ö–æ–¥ - –æ—Å–º–æ—Ç—Ä –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π –≤ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–º —Ç–µ–º–ø–µ
                            </label>
                            <label class="option-card d-block">
                                <input type="radio" name="pace" value="–¢—Ä–µ–∫–∏–Ω–≥">
                                <span class="emoji-option">üèÉ</span> –ë–µ–≥—É–Ω - –∞–∫—Ç–∏–≤–Ω—ã–µ —ç–∫—Å–∫—É—Ä—Å–∏–∏ –∏ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è
                            </label>
                            <label class="option-card d-block">
                                <input type="radio" name="pace" value="–ì–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—è,–í–∏–Ω–æ">
                                <span class="emoji-option">üçΩÔ∏è</span> –ì—É—Ä–º–∞–Ω - –æ—Ç —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –∫ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—É
                            </label>
                        </div>
                    </div>

                    <!-- –í–æ–ø—Ä–æ—Å 5: –ö–æ–º–ø–∞–Ω–∏—è -->
                    <div class="survey-question" id="q5" style="display:none;">
                        <h4><span class="badge bg-primary me-2">5/6</span> –° –∫–µ–º –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ? üë•</h4>
                        <div class="options mt-3">
                            <label class="option-card d-block">
                                <input type="radio" name="company" value="–°–µ–º–µ–π–Ω—ã–π">
                                <span class="emoji-option">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span> –°–µ–º—å–µ–π - —Å –¥–µ—Ç—å–º–∏ –∏–ª–∏ —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞–º–∏
                            </label>
                            <label class="option-card d-block">
                                <input type="radio" name="company" value="–ü–ª—è–∂–Ω—ã–π –æ—Ç–¥—ã—Ö,–†–µ–ª–∞–∫—Å">
                                <span class="emoji-option">üíë</span> –í–¥–≤–æ–µ–º - —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ
                            </label>
                            <label class="option-card d-block">
                                <input type="radio" name="company" value="–ì–æ—Ä–Ω–æ–ª—ã–∂–Ω—ã–π –∫—É—Ä–æ—Ä—Ç,–¢—Ä–µ–∫–∏–Ω–≥">
                                <span class="emoji-option">üëØ</span> –° –¥—Ä—É–∑—å—è–º–∏ - –≤–µ—Å–µ–ª–æ –∏ –∞–∫—Ç–∏–≤–Ω–æ
                            </label>
                            <label class="option-card d-block">
                                <input type="radio" name="company" value="–≠–∫—Å–∫—É—Ä—Å–∏—è,–ì–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—è">
                                <span class="emoji-option">üßò</span> –û–¥–∏–Ω/–æ–¥–Ω–∞ - –≤—Ä–µ–º—è –¥–ª—è —Å–µ–±—è
                            </label>
                        </div>
                    </div>

                    <!-- –í–æ–ø—Ä–æ—Å 6: –í–∏–∑–∞ -->
                    <div class="survey-question" id="q6" style="display:none;">
                        <h4><span class="badge bg-primary me-2">6/6</span> –í–∞—à–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ –≤–∏–∑–∞–º? üõÇ</h4>
                        <div class="options mt-3">
                            <label class="option-card d-block">
                                <input type="radio" name="visa" value="–ù–µ –Ω—É–∂–Ω–∞ –≤–∏–∑–∞">
                                <span class="emoji-option">üëç</span> –¢–æ–ª—å–∫–æ –±–µ–∑–≤–∏–∑–æ–≤—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                            </label>
                            <label class="option-card d-block">
                                <input type="radio" name="visa" value="–ù—É–∂–Ω–∞ –≤–∏–∑–∞">
                                <span class="emoji-option">‚úàÔ∏è</span> –ì–æ—Ç–æ–≤(–∞) –æ—Ñ–æ—Ä–º–ª—è—Ç—å –≤–∏–∑—É —Ä–∞–¥–∏ –∫—Ä—É—Ç–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                            </label>
                            <label class="option-card d-block">
                                <input type="radio" name="visa" value="">
                                <span class="emoji-option">ü§∑</span> –ù–µ –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–æ - –≥–ª–∞–≤–Ω–æ–µ —á—Ç–æ–±—ã —Å—Ç—Ä–∞–Ω–∞ –ø–æ–Ω—Ä–∞–≤–∏–ª–∞—Å—å
                            </label>
                            <label class="option-card d-block">
                                <input type="radio" name="visa" value="–õ—é–∫—Å">
                                <span class="emoji-option">üíé</span> VIP-–≤–∏–∑–∞ - –µ—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∞ —Ç–æ–≥–æ —Å—Ç–æ–∏—Ç
                            </label>
                        </div>
                    </div>

                    <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è —Ç–µ–≥–æ–≤ -->
                    <input type="hidden" id="selectedTags" name="tags">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" id="prevBtn" style="display:none;">
                        <i class="fas fa-arrow-left me-1"></i> –ù–∞–∑–∞–¥
                    </button>
                    <button type="button" class="btn btn-primary" id="nextBtn">
                        –î–∞–ª–µ–µ <i class="fas fa-arrow-right ms-1"></i>
                    </button>
                    <button type="submit" class="btn btn-success" id="submitBtn" style="display:none;">
                        <i class="fas fa-paper-plane me-1"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–Ω–∫–µ—Ç—É
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/js/bootstrap.bundle.min.js"></script>
<script>
    // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É
    document.addEventListener('DOMContentLoaded', function() {
        const surveyBtn = document.querySelector('.survey-btn');
        const surveyModal = new bootstrap.Modal(document.getElementById('surveyModal'));

        if (surveyBtn) {
            surveyBtn.addEventListener('click', function() {
                surveyModal.show();
            });
        }

        // –õ–æ–≥–∏–∫–∞ –º–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–π –∞–Ω–∫–µ—Ç—ã
        let currentQuestion = 1;
        const totalQuestions = 6;
        const progressBar = document.getElementById('surveyProgress');

        function updateProgress() {
            const progress = (currentQuestion / totalQuestions) * 100;
            progressBar.style.width = `${progress}%`;
            progressBar.setAttribute('aria-valuenow', progress);
        }

        document.getElementById('nextBtn').addEventListener('click', function() {
            if (validateQuestion(currentQuestion)) {
                document.getElementById('q' + currentQuestion).style.display = 'none';
                currentQuestion++;

                if (currentQuestion <= totalQuestions) {
                    document.getElementById('q' + currentQuestion).style.display = 'block';
                    document.getElementById('prevBtn').style.display = 'inline-block';

                    if (currentQuestion === totalQuestions) {
                        this.style.display = 'none';
                        document.getElementById('submitBtn').style.display = 'inline-block';
                    }

                    updateProgress();
                }
            }
        });

        document.getElementById('prevBtn').addEventListener('click', function() {
            document.getElementById('q' + currentQuestion).style.display = 'none';
            currentQuestion--;
            document.getElementById('q' + currentQuestion).style.display = 'block';

            if (currentQuestion === 1) {
                this.style.display = 'none';
            }

            document.getElementById('nextBtn').style.display = 'inline-block';
            document.getElementById('submitBtn').style.display = 'none';

            updateProgress();
        });

        function validateQuestion(questionNum) {
            const questionDiv = document.getElementById('q' + questionNum);
            const selectedOption = questionDiv.querySelector('input[type="radio"]:checked');

            if (!selectedOption) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞');
                return false;
            }
            return true;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
        const optionCards = document.querySelectorAll('.option-card');
        optionCards.forEach(card => {
            card.addEventListener('click', function() {
                // –£–¥–∞–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —É –≤—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤ —ç—Ç–æ–º –≤–æ–ø—Ä–æ—Å–µ
                const allOptions = this.closest('.options').querySelectorAll('.option-card');
                allOptions.forEach(opt => opt.classList.remove('selected'));

                // –î–æ–±–∞–≤–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –≤–∞—Ä–∏–∞–Ω—Ç—É
                this.classList.add('selected');

                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ–º radio-–∫–Ω–æ–ø–∫—É
                const radio = this.querySelector('input[type="radio"]');
                if (radio) radio.checked = true;
            });
        });

        // –°–±–æ—Ä –≤—Å–µ—Ö —Ç–µ–≥–æ–≤ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
        document.getElementById('preferenceForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const allSelectedValues = [];
            const radioGroups = ['purpose', 'budget', 'season', 'pace', 'company', 'visa'];

            radioGroups.forEach(group => {
                const selected = document.querySelector(`input[name="${group}"]:checked`);
                if (selected && selected.value) {
                    allSelectedValues.push(selected.value);
                }
            });

            // –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ —Ç–µ–≥–∏, —É–¥–∞–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
            const allTags = allSelectedValues.join(',').split(',');
            const uniqueTags = [...new Set(allTags)].filter(tag => tag.trim() !== '');

            document.getElementById('selectedTags').value = uniqueTags.join(',');

            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å AJAX-–æ—Ç–ø—Ä–∞–≤–∫—É –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É
            this.submit();
        });
    });
</script>
</div>