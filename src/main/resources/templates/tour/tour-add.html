<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Добавление тура | Антур</title>
    <link rel="stylesheet" th:href="@{/styles/tour/tour-add-styles.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
<div class="container py-4">
    <header th:insert="~{blocks/header :: header}"></header>

    <div class="add-tour-container">
        <h3 class="form-title"><i class="fas fa-plus-circle me-2"></i>Добавление нового тура</h3>

        <form th:action="@{/tours}" th:method="POST">
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="hotelName" class="form-label">Отель</label>
                    <div class="input-group">
                        <select name="hotelName" class="form-select" id="hotelName" required>
                            <option value="" disabled selected>Выберите отель</option>
                            <option th:each="el : ${hotels}" th:value="${el.name}" th:text="${el.name}"></option>
                        </select>
                        <button type="button" class="btn btn-outline-secondary btn-add-hotel"
                                data-bs-toggle="modal" data-bs-target="#addHotelModal">
                            <i class="fas fa-plus me-1"></i>Добавить
                        </button>
                    </div>
                    <div class="invalid-feedback">Пожалуйста, выберите отель</div>
                </div>

                <div class="col-md-6">
                    <label for="title" class="form-label">Название тура</label>
                    <input type="text" name="title" class="form-control" id="title" placeholder="Введите название тура" required>
                    <div class="invalid-feedback">Введите название тура</div>
                </div>

                <div class="col-12">
                    <label for="description" class="form-label">Описание</label>
                    <textarea name="description" class="form-control" id="description" rows="3" required></textarea>
                    <div class="invalid-feedback">Введите описание тура</div>
                </div>

                <div class="col-md-6">
                    <label for="countryName" class="form-label">Страна</label>
                    <select name="countryName" class="form-select" id="countryName" required>
                        <option value="" disabled selected>Выберите страну</option>
                        <option th:each="el : ${countries}" th:value="${el.name}" th:text="${el.name}"></option>
                    </select>
                    <div class="invalid-feedback">Выберите страну</div>
                </div>

                <div class="col-md-6">
                    <label for="price" class="form-label">Стоимость (руб)</label>
                    <div class="input-group">
                        <input type="number" step="0.01" name="price" class="form-control" id="price"
                               placeholder="0.00" required min="0" max="1000000">
                        <span class="input-group-text">₽</span>
                    </div>
                    <div class="invalid-feedback">Укажите стоимость</div>
                </div>

                <div class="col-md-6">
                    <label for="placeQuantity" class="form-label">Количество мест</label>
                    <input type="number" name="placeQuantity" class="form-control" id="placeQuantity"
                           placeholder="1-15" required min="1" max="15">
                    <div class="invalid-feedback">Укажите количество мест (1-15)</div>
                </div>

                <div class="col-md-6">
                    <label for="startDate" class="form-label">Дата начала</label>
                    <input type="date" name="startDate" class="form-control" id="startDate" required>
                    <div class="invalid-feedback">Выберите дату начала</div>
                </div>

                <div class="col-md-6">
                    <label for="endDate" class="form-label">Дата окончания</label>
                    <input type="date" name="endDate" class="form-control" id="endDate" required>
                    <div class="invalid-feedback">Выберите дату окончания</div>
                </div>

                <div class="col-12 mt-4">
                    <button class="btn btn-submit" type="submit">
                        <i class="fas fa-save me-2"></i>Добавить тур
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<div class="modal fade" id="addHotelModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-hotel me-2"></i>Добавить отель</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form th:action="@{/hotels/add}" th:method="POST">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="hotelCountryName" class="form-label">Страна</label>
                        <select name="hotelCountryName" class="form-select" id="hotelCountryName" required>
                            <option value="" disabled selected>Выберите страну</option>
                            <option th:each="el : ${countries}" th:value="${el.name}" th:text="${el.name}"></option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="newHotelName" class="form-label">Название отеля</label>
                        <input type="text" name="newHotelName" class="form-control" id="newHotelName"
                               placeholder="Введите название отеля" required>
                    </div>
                    <div class="mb-3">
                        <label for="newHotelDescription" class="form-label">Описание</label>
                        <textarea name="newHotelDescription" class="form-control" id="newHotelDescription" rows="3"
                                  required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="rate" class="form-label">Рейтинг</label>
                        <div class="input-group">
                            <input type="number" step="0.1" name="rate" class="form-control" id="rate"
                                   placeholder="1.0-5.0" required min="1" max="5">
                            <span class="input-group-text">/5</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Отмена</button>
                    <button type="submit" class="btn btn-modal-submit">
                        <i class="fas fa-plus me-2"></i>Добавить отель
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/js/bootstrap.bundle.min.js"></script>
<script>
    document.getElementById('countryName').addEventListener('change', function() {
        const country = this.value;
        const hotelSelect = document.getElementById('hotelName');

        fetch(`/hotels/${country}`)
            .then(response => response.json())
            .then(hotels => {
                hotelSelect.innerHTML = '<option value="" disabled selected>Выберите отель</option>';
                hotels.forEach(hotel => {
                    const option = document.createElement('option');
                    option.value = hotel.name;
                    option.textContent = hotel.name;
                    hotelSelect.appendChild(option);
                });
            });
    });

    document.getElementById('startDate').addEventListener('change', function() {
        const endDate = document.getElementById('endDate');
        if (this.value && endDate.value && this.value > endDate.value) {
            endDate.value = '';
        }
        endDate.min = this.value;
    });

    document.getElementById('endDate').addEventListener('change', function() {
        const startDate = document.getElementById('startDate');
        if (this.value && startDate.value && this.value < startDate.value) {
            this.setCustomValidity('Дата окончания должна быть после даты начала');
        } else {
            this.setCustomValidity('');
        }
    });
</script>
</body>
</html>
