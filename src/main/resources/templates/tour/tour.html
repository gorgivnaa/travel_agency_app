<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>–¢—É—Ä—ã</title>
    <link rel="stylesheet" th:href="@{/styles/tour/tour-styles.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body class="bg-light"
      th:classappend="${#authorization.expression('hasAnyAuthority(''ADMIN'', ''MANAGER'')')} ? 'admin-mode' : ''">

<div class="container py-3">
    <header th:insert="~{blocks/header :: header}"></header>

    <div class="container mt-5">
        <div class="container mb-4">
            <div class="row align-items-center">
                <div class="col-md-8 d-flex align-items-center flex-wrap">
                    <h1 class="text-primary mb-3 mb-md-0 me-3"><i class="bi bi-airplane"></i> –ù–∞—à–∏ —Ç—É—Ä—ã</h1>
                    <form th:action="@{/tours/filter}" th:method="GET" class="d-flex align-items-center">
                        <button type="submit" name="sort" value="title,asc" class="icon-button me-2"
                                title="–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ê-–Ø">
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                                 class="bi bi-sort-alpha-down" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                      d="M10.082 5.629 9.664 7H8.598l1.789-5.332h1.234L13.402 7h-1.12l-.419-1.371h-1.781zm1.57-.785L11 2.687h-.047l-.652 2.157h1.351"/>
                                <path d="M12.96 14H9.028v-.691l2.579-3.72v-.054H9.098v-.867h3.785v.691l-2.567 3.72v.054h2.645V14zM4.5 2.5a.5.5 0 0 0-1 0v9.793l-1.146-1.147a.5.5 0 0 0-.708.708l2 1.999.007.007a.497.497 0 0 0 .7-.006l2-2a.5.5 0 0 0-.707-.708L4.5 12.293z"/>
                            </svg>
                        </button>
                        <button type="submit" name="sort" value="title,desc" class="icon-button me-2"
                                title="–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –Ø-–ê">
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                                 class="bi bi-sort-alpha-down-alt" viewBox="0 0 16 16">
                                <path d="M12.96 7H9.028v-.691l2.579-3.72v-.054H9.098v-.867h3.785v.691l-2.567 3.72v.054h2.645V7z"/>
                                <path fill-rule="evenodd"
                                      d="M10.082 12.629 9.664 14H8.598l1.789-5.332h1.234L13.402 14h-1.12l-.419-1.371h-1.781zm1.57-.785L11 9.688h-.047l-.652 2.156h1.351z"/>
                                <path d="M4.5 2.5a.5.5 0 0 0-1 0v9.793l-1.146-1.147a.5.5 0 0 0-.708.708l2 1.999.007.007a.497.497 0 0 0 .7-.006l2-2a.5.5 0 0 0-.707-.708L4.5 12.293z"/>
                            </svg>
                        </button>
                        <button type="submit" name="sort" value="price,desc" class="icon-button me-2"
                                title="–¶–µ–Ω–∞ –ø–æ —É–±—ã–≤–∞–Ω–∏—é">
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                                 class="bi bi-sort-numeric-down-alt" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                      d="M11.36 7.098c-1.137 0-1.708-.657-1.762-1.278h1.004c.058.223.343.45.773.45.824 0 1.164-.829 1.133-1.856h-.059c-.148.39-.57.742-1.261.742-.91 0-1.72-.613-1.72-1.758 0-1.148.848-1.836 1.973-1.836 1.09 0 2.063.637 2.063 2.688 0 1.867-.723 2.848-2.145 2.848zm.062-2.735c.504 0 .933-.336.933-.972 0-.633-.398-1.008-.94-1.008-.52 0-.927.375-.927 1 0 .64.418.98.934.98"/>
                                <path d="M12.438 8.668V14H11.39V9.684h-.051l-1.211.859v-.969l1.262-.906h1.046zM4.5 2.5a.5.5 0 0 0-1 0v9.793l-1.146-1.147a.5.5 0 0 0-.708.708l2 1.999.007.007a.497.497 0 0 0 .7-.006l2-2a.5.5 0 0 0-.707-.708L4.5 12.293z"/>
                            </svg>
                        </button>
                        <button type="submit" name="sort" value="price,asc" class="icon-button"
                                title="–¶–µ–Ω–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é">
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                                 class="bi bi-sort-numeric-down" viewBox="0 0 16 16">
                                <path d="M12.438 1.668V7H11.39V2.684h-.051l-1.211.859v-.969l1.262-.906h1.046z"/>
                                <path fill-rule="evenodd"
                                      d="M11.36 14.098c-1.137 0-1.708-.657-1.762-1.278h1.004c.058.223.343.45.773.45.824 0 1.164-.829 1.133-1.856h-.059c-.148.39-.57.742-1.261.742-.91 0-1.72-.613-1.72-1.758 0-1.148.848-1.835 1.973-1.835 1.09 0 2.063.636 2.063 2.687 0 1.867-.723 2.848-2.145 2.848zm.062-2.735c.504 0 .933-.336.933-.972 0-.633-.398-1.008-.94-1.008-.52 0-.927.375-.927 1 0 .64.418.98.934.98z"/>
                                <path d="M4.5 2.5a.5.5 0 0 0-1 0v9.793l-1.146-1.147a.5.5 0 0 0-.708.708l2 1.999.007.007a.497.497 0 0 0 .7-.006l2-2a.5.5 0 0 0-.707-.708L4.5 12.293z"/>
                            </svg>
                        </button>
                    </form>
                </div>
                <div class="col-md-4 text-md-end mt-3 mt-md-0">
                    <div class="filter-search-group">
                        <div class="filter-wrapper">
                            <input type="checkbox" id="filterToggle" class="filter-toggle">
                            <label for="filterToggle" class="filter-btn">
                                <span class="icon">üîç</span>
                                –§–∏–ª—å—Ç—Ä—ã
                            </label>
                            <div class="filter-dropdown">
                                <form th:action="@{/tours/filter}" th:method="GET" class="filter-form">
                                    <label for="countryName">–°—Ç—Ä–∞–Ω–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</label>
                                    <select id="countryName" name="countryName" class="form-select">
                                        <option value="" selected>–í—Å–µ —Å—Ç—Ä–∞–Ω—ã</option>
                                        <option th:each="country : ${countries}"
                                                th:value="${country.name}"
                                                th:text="${country.name}">
                                        </option>
                                    </select>

                                    <label for="maxPrice">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞</label>
                                    <input type="number" id="maxPrice" class="form-control"
                                           min="0" name="price" placeholder="–ù–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ">

                                    <button type="submit" class="apply-btn">
                                        –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                                    </button>
                                </form>
                            </div>
                        </div>

                        <form th:action="@{/tours/search}" th:method="GET" class="search-form">
                            <div class="input-group">
                                <input class="form-control" type="search" name="titleOrDescription"
                                       placeholder="–ù–∞–π—Ç–∏ —Ç—É—Ä..." aria-label="Search">
                                <button class="btn btn-outline-secondary" type="submit">
                                    <i class="bi bi-search"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div sec:authorize="hasAuthority('ADMIN')" class="text-end mb-4">
        <a th:href="@{/tours/add}" class="btn btn-success btn-lg">
            <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Ç—É—Ä
        </a>
    </div>

    <!-- –î–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - –∫–∞—Ä—Ç–æ—á–∫–∏ -->
    <div th:unless="${#authorization.expression('hasAnyAuthority(''ADMIN'', ''MANAGER'')')}"
         class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 card-view">
        <div th:each="el : ${tours}" class="col">
            <div class="tour-card h-100 animate__animated animate__fadeInUp">
                <div class="tour-header">
                    <div class="tour-title">
                        <h3 th:text="${el.title}"></h3>
                        <div class="price-tag">
                            <span th:text="${el.price} + ' ‚ÇΩ'"></span>
                        </div>
                    </div>
                </div>
                <div class="tour-body">
                    <p class="tour-description" th:text="${el.description}"></p>
                    <div class="action-buttons">
                        <a th:href="@{/tours/{id}(id=${el.id})}" class="btn-details">
                            <i class="bi bi-info-circle"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –î–ª—è –∞–¥–º–∏–Ω–æ–≤ –∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ - —Ç–∞–±–ª–∏—Ü–∞ -->
    <div th:if="${#authorization.expression('hasAnyAuthority(''ADMIN'', ''MANAGER'')')}" class="table-view">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                <tr>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                    <th>–¶–µ–Ω–∞</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="el : ${tours}">
                    <td class="tour-title" th:text="${el.title}"></td>
                    <td class="tour-description" th:text="${el.description}"></td>
                    <td>
                        <div class="price-tag" th:text="${el.price} + ' ‚ÇΩ'"></div>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <a th:href="@{/tours/{id}(id=${el.id})}" class="btn-details">
                                <i class="bi bi-info-circle"></i>
                            </a>
                            <div class="options-dropdown">
                                <button class="options-button">
                                    <i class="bi bi-three-dots-vertical"></i>
                                </button>
                                <div class="dropdown-content">
                                    <a th:href="@{/tours/edit/{id}(id=${el.id})}">
                                        <i class="bi bi-pencil"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                    </a>
                                    <form th:action="@{/tours/{id}(id=${el.id})}" th:method="DELETE">
                                        <button sec:authorize="hasAuthority('ADMIN')" type="submit"
                                                class="delete-button">
                                            <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

</div>

<footer th:insert="~{blocks/footer :: footer}"></footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/js/bootstrap.bundle.min.js"></script>
</body>
</html>